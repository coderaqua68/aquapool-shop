import { Pool, neonConfig } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-serverless';
import { products } from './shared/schema.ts';
import { eq } from 'drizzle-orm';
import ws from 'ws';

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WebSocket –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Neon
neonConfig.webSocketConstructor = ws;

// –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –∑–∞–ø–∞—Å–Ω—ã—Ö –ø–ª–µ–Ω–æ–∫ –õ–∞–≥—É–Ω–∞
const lagunaFilmsUpdates = [
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.57 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187774/1",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188002",
    price: 27375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188005",
    price: 39375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.0 x 3.0 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188020",
    price: 21000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.0 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188001",
    price: 34500
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.57 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187862",
    price: 30000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188003",
    price: 27375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.49 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187775",
    price: 20250
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.49 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187841",
    price: 20250
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187998",
    price: 24750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.88 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187709/1",
    price: 24750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.88 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187907",
    price: 34500
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.88 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187840",
    price: 24750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187995",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.66 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187773",
    price: 15750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187986",
    price: 15750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187988",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.05 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187849",
    price: 14625
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.05 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5149958",
    price: 14625
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.05 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187931",
    price: 18750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187983",
    price: 14625
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –ì–∏–≥–∞–±–∞—Å—Å 3 x 1.65 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187892",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 2.5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187979",
    price: 8625
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 2.5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187978",
    price: 8625
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 2.44 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187848",
    price: 8625
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 2.44 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187935",
    price: 8625
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187997",
    price: 30000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188004",
    price: 39375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.0 x 3.0 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188021",
    price: 27000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5.0 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5188000",
    price: 34500
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.66 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187844",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.0 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187985",
    price: 18750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187999",
    price: 24750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.57 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187839",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.57 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187845",
    price: 30000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187994",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4.5 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187996",
    price: 30000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187991",
    price: 18000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187993",
    price: 24750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187990",
    price: 18000
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 4 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187992",
    price: 24750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.66 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5181830",
    price: 15750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187987",
    price: 15750
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3.5 x 1.4 –º (–º—Ä–∞–º–æ—Ä 0.6 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187989",
    price: 21375
  },
  {
    name: "–ó–∞–ø–∞—Å–Ω–∞—è –ø–ª–µ–Ω–∫–∞ –∫ –±–∞—Å—Å–µ–π–Ω—É –õ–∞–≥—É–Ω–∞ 3 x 1.4 –º (–≥–æ–ª—É–±–∞—è 0.4 –º–º), –∞—Ä—Ç–∏–∫—É–ª 5187982",
    price: 14625
  }
];

async function updateLagunaFilmsPrices() {
  if (!process.env.DATABASE_URL) {
    throw new Error('DATABASE_URL environment variable is required');
  }

  const pool = new Pool({ connectionString: process.env.DATABASE_URL });
  const db = drizzle(pool);

  console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∑–∞–ø–∞—Å–Ω—ã—Ö –ø–ª–µ–Ω–æ–∫ –õ–∞–≥—É–Ω–∞...');
  
  let updatedCount = 0;
  let notFoundCount = 0;
  let errors = [];

  for (const update of lagunaFilmsUpdates) {
    try {
      // –ò—â–µ–º —Ç–æ–≤–∞—Ä –ø–æ —Ç–æ—á–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é
      const existingProducts = await db
        .select()
        .from(products)
        .where(eq(products.name, update.name));
      
      if (existingProducts.length > 0) {
        const product = existingProducts[0];
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—É (–±–µ–∑ originalPrice, —Ç–∞–∫ –∫–∞–∫ –≤ —Å–ø–∏—Å–∫–µ —É–∫–∞–∑–∞–Ω–æ "‚Äî")
        await db
          .update(products)
          .set({
            price: update.price.toString()
          })
          .where(eq(products.id, product.id));
        
        console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${product.name}`);
        console.log(`   –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞: ${product.price} ‚Üí –ù–æ–≤–∞—è —Ü–µ–Ω–∞: ${update.price}`);
        updatedCount++;
      } else {
        console.log(`‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω: ${update.name}`);
        notFoundCount++;
      }
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ "${update.name}":`, error.message);
      errors.push({ name: update.name, error: error.message });
    }
  }

  console.log('\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –∑–∞–ø–∞—Å–Ω—ã—Ö –ø–ª–µ–Ω–æ–∫ –õ–∞–≥—É–Ω–∞:');
  console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${updatedCount}`);
  console.log(`‚ùå –¢–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: ${notFoundCount}`);
  console.log(`üìù –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${lagunaFilmsUpdates.length}`);
  
  if (errors.length > 0) {
    console.log(`‚ö†Ô∏è –û—à–∏–±–æ–∫: ${errors.length}`);
  }

  await pool.end();
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
updateLagunaFilmsPrices()
  .then(() => {
    console.log('üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∑–∞–ø–∞—Å–Ω—ã—Ö –ø–ª–µ–Ω–æ–∫ –õ–∞–≥—É–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
    process.exit(0);
  })
  .catch((error) => {
    console.error('üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω –∑–∞–ø–∞—Å–Ω—ã—Ö –ø–ª–µ–Ω–æ–∫ –õ–∞–≥—É–Ω–∞:', error);
    process.exit(1);
  });