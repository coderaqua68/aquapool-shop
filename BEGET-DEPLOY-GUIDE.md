# Руководство по развертыванию AquaPool на Beget.com

## Предварительные требования

1. Зарегистрированный аккаунт на Beget.com
2. Купленный и настроенный домен
3. Доступ к панели управления хостингом

## Шаг 1: Подготовка файлов для загрузки

### 1.1 Создание production build

```bash
# Сборка фронтенда
npm run build

# Создание архива с готовыми файлами
```

### 1.2 Файлы для загрузки на хостинг

Необходимо загрузить:
- Папку `dist/` (собранный фронтенд)
- Папку `server/` (бэкенд)
- Файлы `package.json`, `package-lock.json`
- Конфигурационные файлы

## Шаг 2: Настройка базы данных PostgreSQL

### 2.1 Создание базы данных в панели Beget

1. Войдите в панель управления Beget
2. Перейдите в раздел "Базы данных" → "PostgreSQL"
3. Создайте новую базу данных:
   - Имя БД: `aquapool_db`
   - Пользователь: создайте нового пользователя
   - Пароль: сгенерируйте надежный пароль

### 2.2 Получение данных подключения

Запишите данные подключения:
- Хост: обычно `localhost` или IP-адрес сервера
- Порт: обычно `5432`
- Имя БД: `aquapool_db`
- Пользователь: ваш пользователь БД
- Пароль: ваш пароль БД

## Шаг 3: Настройка переменных окружения

### 3.1 Создание файла .env для production

Создайте файл `.env` с настройками для production:

```
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://username:password@host:port/database_name
TELEGRAM_BOT_TOKEN=7550930591:AAHZHqOnklv8EFkID5XaTkgzCrGwhY3Ex7M
TELEGRAM_ADMIN_CHAT_IDS=5696137293
```

### 3.2 Настройка переменных в панели Beget

В зависимости от типа хостинга Beget, переменные окружения настраиваются:
- Через файл `.env`
- Через панель управления хостингом
- Через файл конфигурации Node.js

## Шаг 4: Загрузка файлов на сервер

### 4.1 Подключение по FTP/SFTP

1. Используйте FileZilla или встроенный файловый менеджер Beget
2. Подключитесь к серверу:
   - Хост: ваш домен или IP
   - Пользователь: ваш FTP логин
   - Пароль: ваш FTP пароль

### 4.2 Структура файлов на сервере

```
/public_html/
├── dist/                 # Статические файлы фронтенда
│   ├── index.html
│   ├── assets/
│   └── ...
├── server/              # Бэкенд приложения
│   ├── index.js
│   ├── routes.js
│   └── ...
├── package.json
├── .env                 # Переменные окружения
└── node_modules/        # Зависимости (установятся автоматически)
```

## Шаг 5: Установка зависимостей Node.js

### 5.1 Доступ по SSH

1. Подключитесь к серверу по SSH
2. Перейдите в директорию сайта:
   ```bash
   cd /home/username/public_html/
   ```

### 5.2 Установка зависимостей

```bash
# Установка production зависимостей
npm install --production

# Если нужны dev зависимости для сборки
npm install
```

## Шаг 6: Настройка базы данных

### 6.1 Создание таблиц

```bash
# Применение миграций базы данных
npm run db:push
```

### 6.2 Проверка подключения

Убедитесь, что приложение может подключиться к базе данных.

## Шаг 7: Настройка веб-сервера

### 7.1 Настройка для Apache (если используется)

Создайте файл `.htaccess` в корне:

```apache
RewriteEngine On

# Перенаправление API запросов на Node.js
RewriteRule ^api/(.*)$ http://localhost:3000/api/$1 [P,L]

# Обслуживание статических файлов
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /dist/index.html [L]
```

### 7.2 Настройка для Nginx (если используется)

```nginx
server {
    listen 80;
    server_name yourdomain.com;
    root /home/username/public_html/dist;
    index index.html;

    # Статические файлы
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API запросы
    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## Шаг 8: Запуск приложения

### 8.1 Запуск Node.js сервера

```bash
# Запуск в production режиме
npm start

# Или запуск с PM2 (если доступен)
pm2 start server/index.js --name "aquapool"
```

### 8.2 Настройка автозапуска

Настройте автоматический запуск приложения при перезагрузке сервера.

## Шаг 9: Настройка домена

### 9.1 DNS настройки

Убедитесь, что домен направлен на IP-адрес вашего сервера Beget.

### 9.2 SSL сертификат

1. В панели Beget включите бесплатный SSL от Let's Encrypt
2. Или загрузите собственный SSL сертификат

## Шаг 10: Тестирование

### 10.1 Проверка функциональности

1. Откройте сайт в браузере
2. Проверьте:
   - Загрузка главной страницы
   - Работу каталога товаров
   - Функцию поиска
   - Оформление заказа
   - Админ-панель
   - Telegram уведомления

### 10.2 Проверка производительности

1. Тестируйте скорость загрузки
2. Проверьте работу под нагрузкой
3. Мониторьте использование ресурсов

## Возможные проблемы и решения

### Проблема: Node.js не запускается

**Решение:**
- Проверьте версию Node.js на сервере
- Убедитесь в правильности переменных окружения
- Проверьте логи ошибок

### Проблема: База данных не подключается

**Решение:**
- Проверьте корректность DATABASE_URL
- Убедитесь, что PostgreSQL запущен
- Проверьте права доступа пользователя БД

### Проблема: Статические файлы не загружаются

**Решение:**
- Проверьте настройки веб-сервера
- Убедитесь в правильности путей к файлам
- Проверьте права доступа к папкам

## Мониторинг и обслуживание

### Регулярные задачи

1. Резервное копирование базы данных
2. Обновление зависимостей
3. Мониторинг логов
4. Проверка работоспособности Telegram бота

### Логирование

Настройте логирование ошибок и мониторинг производительности.

---

## Контакты для поддержки

При возникновении проблем обращайтесь в техподдержку Beget.com или используйте документацию хостинга.